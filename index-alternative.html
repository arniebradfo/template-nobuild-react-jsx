<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Build React JSX Demo</title>
    <style>
      * {
        font-family: sans-serif;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Import map for React dependencies -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@19.1.0",
            "react-dom/": "https://esm.sh/react-dom@19.1.0/"
        }
    }
    </script>

    <!-- Register service worker and inject React app code dynamically -->
    <script>
        async function startApp() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('./service-worker.js');
                    console.log('Service Worker registered:', registration);
                    
                    await navigator.serviceWorker.ready;
                    
                    if (navigator.serviceWorker.controller) {
                        loadReactApp();
                    } else {
                        navigator.serviceWorker.addEventListener('controllerchange', loadReactApp);
                    }
                } catch (error) {
                    console.error('Service Worker registration failed:', error);
                    loadReactApp();
                }
            } else {
                console.error('Service Workers not supported');
                loadReactApp();
            }
        }

        function loadReactApp() {
            // Option 2: Inject the module script as a string
            // This guarantees it only exists after SW is ready
            const script = document.createElement('script');
            script.type = 'module';
            script.textContent = `
                import React from "react";
                import { createRoot } from "react-dom/client";
                import { App } from './components/App.jsx';

                const container = document.getElementById('root');
                const root = createRoot(container);
                root.render(React.createElement(App));
            `;
            document.head.appendChild(script);
        }

        startApp();
    </script>
</body>
</html> 